# PRD v2 – DDPW Moneybook Flux (MVP)

## 1. 제품 개요

- 제품명: DDPW Moneybook Flux v2
- 유형: 부부 공동 가계부 웹앱 (기존 XLSX 가계부 → Web 전환)

- 개발 환경
  - 1차: Google Antigravity(바이브 코딩)로 HTML/Vanilla JS/CSS 기반 기능 구현
  - 2차: 필요 시 Claude Code로 코드 리팩토링 및 기능 확장

- 저장 방식
  - 브라우저 localStorage에 JSON 구조로 데이터 저장 (ddpw_* 네이밍 규칙 사용)
  - 서버·백엔드 없음 (순수 프론트엔드 앱)

---

## 2. 타깃 사용자 및 문제 정의

- 타깃
  - 부부(파우/둠둠) + 공용 계정을 함께 관리하는 2인 가구
  - 이미 엑셀 가계부를 쓰고 있으나, 입력·집계·고정지출·계좌 흐름 관리가 번거로운 사용자

- 주요 문제
  - 월별 수입·지출, 카드/계좌별 사용액, 고정지출, 예산 달성률을 한 번에 보기 어렵다
  - 연도별로 나뉜 엑셀 파일과 월별 시트 구조 때문에, 전월 대비 잔액 변동·카테고리별 예산 초과 여부를 직관적으로 파악하기 힘들다
  - 부부가 공동으로 쓰는 경우, “누가 어떤 지출을 했는지”를 기준으로 필터링·분석하는 과정이 반복적이고 귀찮다

---

## 3. 목표 및 성공 지표

- 목표
  - 엑셀보다 입력·조회·월말 정리가 편한 부부 공동 가계부를 만든다
  - 부부가 한 달 이상 실제로 사용하면서, “엑셀로 돌아갈 필요가 없다”고 느끼는 수준을 달성한다

- 1차 성공 지표
  - 둠둠파우 + 배우자가 최소 1개월 이상 실사용
  - 월 300건 수준의 거래가 누적되어도 필터/정렬/요약이 체감상 무리 없이 동작
  - “이번 달 어디에 얼마나 썼고, 예산을 넘은 곳이 어딘지”를 1분 내에 확인 가능

---

## 4. 기능 범위 (MVP In Scope)

### 4.1 사용자·항목 관리

#### 4.1.1 사용자

- 고정 사용자: 공용, 파우, 둠둠 3명으로 한정한다

#### 4.1.2 카테고리(1~3 Depth)

- 수입/지출 카테고리는 1~3 Depth 구조로 관리한다
  - 예: 지출 → 생활(Depth 1) → 가전(Depth 2) → 주방가전(Depth 3)
- 수입/지출 각각에 대해 대분류(Depth 1) – 중분류(Depth 2) – 소분류(Depth 3)를 정의할 수 있다
- 각 카테고리 항목은 “내부 코드/ID + 표시 이름” 구조로 관리하여, 추후 병합/분리/이름 변경에 유연하게 대응한다

#### 4.1.3 결제수단 (PAYMENT_METHODS)

- 결제수단은 다음 그룹으로 나눈다
  - 신용카드, 체크카드, 계좌, 기타(페이, 현금 등)
- 각 결제수단 항목은 다음 정보를 가진다.
  - 표시 이름 (예: “KB탄탄대로(파우)”)
  - 내부 Key 또는 ID (카드사/계좌 ID 등)
  - 유형 (credit / debit / transfer / cash / other)
- 카드 항목에는 선택적으로 유효기간(expiry)을 기록할 수 있다 (예: MM/YY)

#### 4.1.4 계좌 목록 (ACCOUNT_DETAILS)

- 계좌 메타데이터 구조 예시
  - 계좌번호
  - 계좌명
  - 은행명
  - 메모(용도: 급여 계좌, 비상금 계좌 등)
  - (선택) 초기 잔액
  - 활성/비활성 플래그(active: true/false)

- 활성/비활성 플래그:
  - 비활성 계좌/카드는 기본 선택 목록에서 숨기되, 과거 거래 데이터는 유지한다

#### 4.1.5 항목관리 탭 역할

- ‘항목관리’ 탭에서 위 항목(카테고리, 결제수단, 계좌)을 CRUD(추가/수정/삭제) 할 수 있다
- 항목관리 변경 내용은 전역 DB처럼 실시간 반영되며,
  - 사용내역 입력 모달, 검색/필터 드롭다운, 계좌관리 화면 등에서 즉시 최신 상태로 보여야 한다

#### 4.1.6 저장

- 항목관리 데이터 전체는 ddpw_config 키에 JSON 형태로 저장한다

---

### 4.2 사용내역 관리 (월별 거래 + 엑셀 업로드)

> 월별로 “카드 사용, 현금/계좌 입출금” 내역을 관리하는 화면. 사용자가 직접 입력하거나 엑셀 파일에서 불러온 내역을 기반으로 한다.

#### 4.2.1 데이터 단위

- 기준 단위: 거래(트랜잭션)
  - 카드 결제, 현금 지출, 계좌 이체, 급여 입금 등 단일 이벤트를 의미한다
- 저장 위치:
  - 월별 거래는 ddpw_transactions_YYYY_MM 배열로 저장한다 (예: ddpw_transactions_2025_01)

- 필수 필드(요약):
  - id, date(YYYY-MM-DD), user, type(income/expense),
    mainCategory, subCategory(또는 depth 구조),
    merchant, detail, amount(양수 숫자),
    paymentMethod(credit/debit/transfer/cash 등),
    paymentDetail(실제 카드/계좌명),
    isFixed, fixedMasterId, createdAt, updatedAt

#### 4.2.2 입력 방식

1) 건별 수동 입력

- 거래 입력 모달에서 다음 필드를 입력한다
  - 필수:
    - 사용일자
    - 사용자(공용/파우/둠둠)
    - 구분(수입/지출)
    - 카테고리(1~3 Depth)
    - 금액
    - 결제방법 (paymentMethod)
    - 세부 결제수단 (paymentDetail)
  - 선택:
    - 사용처(가맹점)
    - 세부내용(메모)
- 금액은 1원 이상 양수만 허용하며, 필수 필드 누락 시 경고 후 저장을 차단한다

2) 엑셀 파일 업로드 (MVP – 타입 1만)

- 카드사/은행에서 내려받은 거래 명세서 엑셀/CSV 파일을 업로드하면, 내부 파서가 거래 목록으로 변환한다
- 카드사별 양식이 다를 수 있으므로:
  - v2(MVP)에서는 공통 템플릿 또는 지원 카드사 1~2곳의 포맷만 우선 지원한다
  - 기존 엑셀 가계부(내 포맷) 월 시트 전체를 Import 하는 기능은 향후(Phase 2 이상) 참고용으로만 고려한다
- 파싱 결과는 “임시 목록(미확정 상태)”으로 먼저 표시하고, 사용자가 확인 후 일괄 저장한다

#### 4.2.3 월별 관리 및 대시보드 연동

- 사용내역은 월별로 저장·조회되며,
  - 당월 데이터는 월별 현황 대시보드(수입/지출 합계, 고정/변동 구분, 카테고리별 예산 달성률 등)와 자동 연동된다
- 월 변경 시:
  - 해당 월의 ddpw_transactions_YYYY_MM을 불러와 테이블·그래프를 갱신한다

#### 4.2.4 중복 감지

- 엑셀 업로드 또는 수동 입력 저장 시, 다음 주요 필드를 기준으로 중복 거래를 감지한다
  - 날짜, 금액, 결제수단, 사용처(또는 가맹점)
- 중복 의심 건이 있으면 사용자에게
  - “동일/유사 거래가 N건 있습니다. 그래도 저장하시겠습니까?” 형태로 확인을 요청한다
- 사용자는 건별로 “유지/제외” 또는 일괄 처리 옵션을 선택할 수 있다

#### 4.2.5 계좌관리와의 동기화

- 사용내역 중 계좌 관련 거래는 계좌관리와 동기화된다
  - 유형:
    - 계좌이체(계좌↔계좌)
    - 현금 입출금(계좌↔현금)
    - 카드 대금 인출(계좌→카드사, 청구 합계 기준)
- 동기화 규칙:
  - 사용내역에서 paymentMethod가 transfer 또는 cash인 경우,
    지정된 출금 계좌·입금 계좌 정보를 기반으로 해당 계좌의 입출금 이력에 반영한다
  - 카드 개별 사용내역(각 결제 건)은 “사용내역 관리”에는 존재하지만,
    계좌관리에는 카드 대금 인출(청구 합계)만 반영한다
  - 같은 이벤트가 “사용내역 + 계좌 이력” 양쪽에 중복으로 저장되더라도,
    잔액 계산 단계에서 중복 반영되지 않도록 중복/소스 타입 로직으로 방지한다
  - 카드 명세서 청구금액 vs 실제 계좌 출금 금액의 일치 여부를 검증하는 기능은 Phase 2 이상에서 구현한다

#### 4.2.6 예산 관리(카테고리별 예산)

- 엑셀 월 시트의 “대분류/소분류별 예산·실적·증감” 표를 웹에서 대체하기 위해, 카테고리별 예산 관리 기능을 제공한다
- 기능:
  - 연도/월별·카테고리별(대분류 또는 대분류+소분류) 예산 금액을 입력·수정·삭제할 수 있다
  - “전월 예산 복사” 기능을 제공해, 이전 달 예산을 기준으로 일부 항목만 수정하는 패턴을 지원한다
- 저장:
  - 예산 데이터는 ddpw_budgets_YYYY 또는 ddpw_budgets_YYYY_MM 구조로 저장한다 (최종 구조는 구현 시 확정)
- 월별 현황 대시보드(4.5)에서 예산과 실제를 비교해 달성률·색상 인디케이터에 사용한다

---

### 4.3 계좌관리 (계좌별 입출금 및 이력)

> 각 계좌의 입금/출금 흐름을 월별로 관리하고, 계좌별 이력을 관점에서 보는 화면.

#### 4.3.1 데이터 단위

- 계좌 정보:
  - ACCOUNT_DETAILS에 계좌 번호, 계좌명, 은행명, 메모(용도), 초기 잔액, 활성 플래그를 저장한다
- 계좌 입출금 이력:
  - 계좌별 거래 이력은 별도 배열 또는 ddpw_account_transactions_YYYY_MM 같은 키로 관리하는 방식을 사용한다
    (또는 transactionData 중 계좌 관련 거래만 필터링하여 계좌뷰로 보여주는 방식은 구현 단계에서 결정)

#### 4.3.2 계좌 CRUD

- 계좌 추가:
  - 계좌번호, 계좌명, 은행명, 메모, (선택) 초기 잔액, 활성 여부를 입력한다
- 계좌 수정:
  - 이름, 메모, 은행, 초기 잔액, 활성 여부를 변경할 수 있다
- 계좌 삭제/비활성화:
  - 과거 거래와의 연결을 위해 완전 삭제 대신 “비활성화(숨김)” 방식을 우선 고려한다

#### 4.3.3 계좌별 입출금 이력 조회

- 계좌 선택 시:
  - 해당 계좌의 월별 입출금 내역(입금/출금/이체/카드 대금 인출 등)을 테이블로 보여준다
- 필터:
  - 연-월 선택(전월/익월 이동)
  - 거래 유형(입금/출금/이체/카드 대금 인출) 필터 옵션

#### 4.3.4 사용내역과의 동기화

- 사용내역 관리(4.2)에서 발생한 계좌 관련 거래는 계좌 이력에 반영된다
  - 계좌이체, 현금 입출금, 카드 대금 인출
- 동기화 정책:
  - 하나의 실질적인 이벤트가 “사용내역 + 계좌 이력” 양쪽에 저장되더라도,
    중복/소스 타입(sourceType) 로직을 통해 같은 금액이 두 번 잔액에 반영되지 않도록 한다

#### 4.3.5 계좌 엑셀 일괄 처리

- 계좌별(또는 전체 계좌 통합) 엑셀 파일로 입출금 내역을 일괄 추가/수정/삭제할 수 있다
- 업로드 시:
  - 날짜, 금액, 잔액, 적요 등의 필드를 기준으로 중복 여부를 검사하고, 사용자에게 결과를 보여준다
  - 사용자는 중복/충돌 건에 대해 개별 또는 일괄 처리(유지/제외/덮어쓰기)를 선택할 수 있다
  - 최종 확정된 레코드만 계좌별 이력에 반영하고, 필요 시 사용내역에도 동기화(예: 계좌이체/현금 입출금)한다

---

### 4.4 고정 거래 관리

> 월세, 관리비, 통신비, 보험료 등 매월 반복되는 고정 수입/지출을 따로 관리하는 기능.

#### 4.4.1 스키마

- FIXED_TRANSACTION_SCHEMA 요약
  - id, user, type(income/expense), amount,
    mainCategory, subCategory,
    paymentMethod, paymentDetail,
    merchant, detail,
    fixedDay(1~31 또는 'last'),
    fixedStart(YYYY-MM), fixedEnd(YYYY-MM 또는 'infinite'),
    createdAt, updatedAt

#### 4.4.2 기능

- 고정 거래 목록 화면:
  - 이름(예: 통신비), 구분, 금액, 일자, 시작월, 종료월, 작업(수정/삭제)를 테이블로 표시한다
- 신규 등록:
  - 모달에서 필수 필드를 입력하고 저장 시 ddpw_fixed_transactions에 추가한다
- 수정:
  - 수정 내용은 “다음 달부터 적용, 과거 월은 그대로 유지” 규칙을 따른다
- 삭제:
  - 삭제해도 과거에 이미 생성된 월별 거래는 유지하고, 향후 자동 생성만 중단한다

#### 4.4.3 자동 생성 로직

- 월 전환 또는 앱 로딩 시:
  - 현재 연-월에 대해 모든 FIXED_TRANSACTION을 스캔한다
  - 해당 월이 fixedStart~fixedEnd 범위에 포함되면, 해당 날짜에 TRANSACTION을 자동 생성한다
  - 생성된 거래에는 isFixed: true, fixedMasterId를 설정한다

---

### 4.5 월별 현황 대시보드

> 월별 수입/지출/순자산·예산·고정/변동 구조를 한 눈에 보는 화면.

#### 4.5.1 데이터 소스

- 사용내역 관리의 ddpw_transactions_YYYY_MM 데이터와,
  계좌관리의 계좌 입출금 이력을 기반으로 월별 수입/지출/순자산을 계산한다
- 계좌별 잔액은 계좌관리의 잔액 및 거래 이력을 기준으로 집계한다
- 예산 정보는 4.2.6의 예산 관리 데이터(ddpw_budgets_*)를 사용한다

#### 4.5.2 레이아웃

- 상단: “YYYY년 MM월 수입/지출 현황” 카드
  - 총 수입(고정/변동), 총 지출(고정/변동), 순자산 변동(전월 대비)
  - 월간 고정 수입/지출 요약 박스:
    - 고정 수입 합계, 고정 지출 합계, 차액을 별도 블록으로 표시한다
- 중단: 카테고리별 예산 현황
  - 카테고리별 예산 vs 실제 사용 금액, 달성률, 색상 인디케이터(초록/노랑/빨강)
- 하단: 결제수단별 사용액, 계좌별 잔액 리스트
  - 카드/페이/현금 등 결제수단별 사용액 합계
  - 계좌별 현재 잔액 및 월별 입출금 요약

#### 4.5.3 계산 규칙

- 당월말 잔액 = 전월말 잔액 + 당월 총수입 – 당월 총지출
- 예산 달성률(%) = actual / budget × 100
- 색상 인디케이터:
  - 80% 이하: 초록색(여유)
  - 80~100%: 노란색(주의)
  - 100% 초과: 빨간색(초과)

#### 4.5.4 향후 확장 (Phase 3 – 연간/AI 분석)

- Phase 3에서 다음을 추가로 구현한다.
  - 연간/기간별 대시보드:
    - 연도 전체/특정 기간(3/6/12개월)의 카테고리별 합계·비율·추이 그래프
  - AI LLM + RAG 기반 분석:
    - 월별/연간 데이터와 사용내역을 기반으로,
      “이번 달 소비 패턴 요약”, “줄이면 좋은 카테고리”, “목표 달성을 위한 시나리오” 등을 자연어 리포트 형태로 제공한다

---

## 5. 비기능 요구사항

- 기술 스택
  - HTML + Vanilla JavaScript + CSS + Bootstrap 5
  - 초기 구현은 Google Antigravity를 통한 바이브 코딩으로 진행하고,
    Claude Code로 리팩토링 및 구조 개선이 가능하도록 파일·모듈 분리를 명확히 한다

- 성능
  - 월별 거래 1,000건까지 필터/정렬/요약이 1초 이내로 동작하는 것을 목표로 한다

- 안정성/데이터
  - localStorage 키 구조는 ddpw_* 패턴을 따른다 (예: ddpw_config, ddpw_transactions_2025_01)
  - 데이터 스키마 변경 시 마이그레이션 전략 또는 버전 플래그를 도입하는 것을 고려한다

---

## 6. Out of Scope (v2에서는 안 하는 것)

- 기존 엑셀 가계부(내 포맷 – 각 연도 파일의 월 시트 전체)를 그대로 Import하는 기능:
  - v2에서는 카드/은행 명세서 기반 Import만 지원하고,
    연도별 엑셀 가계부 전체 마이그레이션은 Phase 2 이상에서 별도 설계한다
- 카드 명세서 상세 포맷 다수 지원:
  - MVP에서는 1~2개 포맷 또는 공통 템플릿만 지원한다
- 은행/카드사 API 연동, SMS 기반 자동 입력
- 복잡한 백업 폴더 구조(saveDataToFolder, 여러 버전 파일명 규칙 등)
- AI 가계부 기능(LLM이 월말 리포트/코칭 문구를 자동 생성하는 기능)은 Phase 3에서 RAG 기반으로 별도 기획·구현한다

---

## 7. 개발·도입 전략 (환경 고려)

- 1단계: Antigravity로 MVP 기능 구현
  - 이 PRD를 기준으로 SKILL 문서 v2를 작성하고,
    config.js, data-manager.js, settings-modal.html/js,
    transaction-modal.html/js, fixed-transaction.js, monthly-summary.js 순서로 작업을 쪼갠다
  - 각 단계마다 “수정 파일·완료 조건·테스트 방법”을 Antigravity 프롬프트에 명시한다

- 2단계: Claude Code로 리팩토링/확장
  - Antigravity가 생성한 코드를 Claude Code로 가져와,
    파일 구조 정리, 중복 코드 제거, 타입·에러 핸들링 개선,
    연간 대시보드 및 AI LLM/RAG 기반 분석 기능 확장 등을 진행한다
